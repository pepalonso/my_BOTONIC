"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.runPlugins = exports.loadPlugins = void 0;
const tslib_1 = require("tslib");
function loadPlugins(plugins) {
    if (!plugins)
        return {};
    const _plugins = {};
    const pluginsLength = plugins.length;
    for (let i = 0; i < pluginsLength; i++) {
        const pluginRequired = plugins[i].resolve;
        const options = plugins[i].options;
        const Plugin = pluginRequired.default;
        const instance = new Plugin(options);
        const id = plugins[i].id || `${instance.constructor.name}`;
        _plugins[id] = instance;
        _plugins[id].id = id;
        _plugins[id].config = options;
        _plugins[id].name = `${instance.constructor.name}`;
    }
    return _plugins;
}
exports.loadPlugins = loadPlugins;
function runPlugins(plugins, mode, input, session, lastRoutePath, response = null, messageEvents = null, dataProvider) {
    return tslib_1.__awaiter(this, void 0, void 0, function* () {
        for (const key in plugins) {
            const p = yield plugins[key];
            try {
                if (mode === 'pre' && p.pre) {
                    yield p.pre({ input, session, lastRoutePath, dataProvider, plugins });
                }
                if (mode === 'post' && p.post) {
                    yield p.post({
                        input,
                        session,
                        lastRoutePath,
                        response,
                        messageEvents,
                        dataProvider,
                        plugins,
                    });
                }
            }
            catch (e) {
                console.log(e);
            }
        }
    });
}
exports.runPlugins = runPlugins;
//# sourceMappingURL=plugins.js.map